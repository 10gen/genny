SchemaVersion: 2018-07-01
Owner: "@mongodb/stm"

Description: |

  This workload measures the overhead of Genny itself. There are 2 different
  configurations that run consecutively for 5 phases each. The first
  configuration runs with 100 threads and the second configuration runs
  with 1 thread.

  The 5 phases of each configuration are as follows:

  1. Loop for 10 seconds using the "Duration" keyword
  2. Loop for 3M iterations using the "Repeat" keyword. Each iteration
     takes around 5Âµs when run in a single thread.
  3. Loop for 10k iterations with a 1 per 1ms rate limit
  4. Loop for 10k iterations while sleeping for 1ms before each iteration
  5. Loop for 10k iterations while sleeping for 1ms after each iteration

  Each iteration is craftered to take around 10s. More configurations
  can be added as needed, but unfortunately the "5 phases" building block
  can't be reused en masse because YAML doesn't support merging lists.

Actors:
- Name: GennyOverhead100T
  Type: NopMetrics
  Threads: 100
  Phases:
  - MetricsName: LoopOnlyFixedTime
    Duration: 10 seconds
  - MetricsName: LoopOnly
    Repeat: 1000000  # 1 million iterations.
  - MetricsName: LoopNRateLimit
    Repeat: 10000
    Rate: 1 per 1 millisecond
  - MetricsName: LoopNSleepBefore
    Repeat: 10000
    SleepBefore: 1 millisecond
  - MetricsName: LoopNSleepAfter
    Repeat: 10000
    SleepAfter: 1 millisecond
  - Phase: 5..9
    Nop: true

- Name: GennyOverhead1T
  Type: NopMetrics
  Threads: 1
  Phases:
  - Phase: 0..4
    Nop: true
  - MetricsName: LoopOnlyFixedTime
    Duration: 10 seconds
  - MetricsName: LoopOnly
    Repeat: 1000000  # 1 million iterations.
  - MetricsName: LoopNRateLimit
    Repeat: 10000
    Rate: 1 per 1 millisecond
  - MetricsName: LoopNSleepBefore
    Repeat: 10000
    SleepBefore: 1 millisecond
  - MetricsName: LoopNSleepAfter
    Repeat: 10000
    SleepAfter: 1 millisecond
