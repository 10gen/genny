# This workload is developed as a general stress test of the server. The original development of
# this workload is described here:
# https://docs.google.com/document/d/1Dz0KyB_Pf94km4cBSpQHTBD7GQ8b3LM4_J350ukWjZ4/edit?usp=sharing
# It loads data into a large number of collections, with 9 indexes on each collection. After loading
# the data, a fraction of the collections are queried, and a smaller fraction of collections are
# updated.

SchemaVersion: 2018-07-01
Owner: "@mongodb/product-perf"

Clients:
  Default:
    QueryOptions:
      maxPoolSize: 1000

Actors:
- Name: Loader
  Type: Loader
  Threads: 20
  Phases:
  - Repeat: 1
    Database: &DB cold
    CollectionCount: &CollectionCount 1
    Threads: 1
    DocumentCount: 20000000
    BatchSize: 100000
    Document:
      a: {^RandomString: { length: 100 }}
  - Repeat: 1
    Database: &DB hot
    CollectionCount: &CollectionCount 5
    Threads: 1
    DocumentCount: 10000000
    BatchSize: 100000
    Document:
      a: {^RandomString: {length: 100 }}

Actors:
- Name: HotSampler
  Type: RandomSampler
  Threads: 200
  Database: hot
  Phases:
  - Repeat: 1
    Duration: 60 minutes

- Name: ColdScanner
  Type: CollectionScanner
  Threads: 20
  Database: cold
  Phases:
  - Repeat: 1
    Duration: 60 minutes
    Interval: 10 minutes