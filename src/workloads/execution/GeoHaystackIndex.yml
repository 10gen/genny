# This workload inserts ~1GB of documents in the first phase, and creates a geoHaystack index on them in the second.

SchemaVersion: 2018-07-01
Owner: "@mongodb/server-execution"

Actors:
- Name: InsertData
  Type: Loader
  Threads: 1
  Phases:
  - Repeat: 1
    Database: &db test
    Threads: 1
    CollectionCount: 1
    DocumentCount: 500000
    BatchSize: 10000
    Document:
      a: [{^RandomInt: {min: -180, max: 180}}, {^RandomInt: {min: -180, max: 180}}]
  - &Nop {Nop: true}

- Name: IndexCollection
  Type: RunCommand
  Threads: 1
  Phases:
  - *Nop
  - Repeat: 1
    Database: *db
    Operation:
      OperationMetricsName: CreateIndexesCmd
      OperationName: RunCommand
      OperationCommand:
        createIndexes: Collection0
        indexes:
        - key: 
            a: "geoHaystack"
            min: -180
            max: 180
            bucketSize: {^RandomInt: {distribution: geometric, p: 0.1}}
          name: geoHaystackIndex
