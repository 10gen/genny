PhaseSchemaVersion: 2018-07-01
Owner: "@mongodb/product-perf"
Description: |
  File to hold common LLT workload phases.


GlobalDefaults:
  dbname: &dbname llt
  InitialDocumentCount: &InitialNumDocs 10000000
  SecondaryDocumentCount: &SecondaryNumDocs 10000000
  InsertPhaseDocumentCount: &InsertPhaseNumDocs 250000

  Document: &Doc
    ts: {^Now: {}}
    caid: {^RandomInt: {min: 0, max: 1000}}
    cuid: {^RandomInt: {min: 0, max: 100000}}
    prod: {^RandomInt: {min: 0, max: 10000}}
    prid: {^RandomDouble: {min: 0.0, max: 1000.0}}
    data: {^Join: {array: ["aaaaaaaaaa", {^FastRandomString: {length: {^RandomInt: {min: 0, max: 10}}}}]}}

  LLTIndexes: &LLTIndexes
    - keys: {cuid: 1, data: 1}
    - keys: {caid: 1, prid: 1, cuid: 1}
    - keys: {prid: 1, ts: 1, cuid: 1}

  InsertWriteCommand:  &InsertCommand
    WriteCommand: insertOne
    Document: *Doc

LoaderPhase:
  BatchSize: 100
  CollectionCount: 4
  Database: *dbname
  Document: *Doc
  DocumentCount: { ^Parameter: { Name: "DocumentCount", Default: *InitialNumDocs } }
  Indexes: { ^Parameter: { Name: "Indexes", Default: *LLTIndexes } }
  Repeat: 1
  Threads: 4

InsertPhase.50:
  DocumentCount: { ^Parameter: { Name: "DocumentCount", Default: *InsertPhaseNumDocs } }
  Collection: { ^Parameter: { Name: "Collection", Default: "Collection0" } }
  GlobalRate: { ^Parameter: { Name: "GlobalRate", Default: "400 per 1 second" } }
  Database: *dbname
  Duration: 5 minutes
  RecordFailure: true
  Threads: { ^Parameter: { Name: "Threads", Default: 4 } }
  Operations:
    - OperationName: bulkWrite
      OperationCommand:
        WriteOperations:
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
        Options:
          WriteConcern:
            Level: majority
