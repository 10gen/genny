PhaseSchemaVersion: 2018-07-01
Owner: "@mongodb/product-perf"
Description: |
  File to hold common LLT workload phases.


GlobalDefaults:
  dbname: &dbname llt
  InitialDocumentCount: &InitialNumDocs 10000000
  SecondaryDocumentCount: &SecondaryNumDocs 10000000
  InsertPhaseDocumentCount: &InsertPhaseNumDocs 250000
  CollectionCount: &InsertCollectionCount 4

  Document: &Doc
    ts: {^Now: {}}
    caid: {^RandomInt: {min: 0, max: 1000}}
    cuid: {^RandomInt: {min: 0, max: 100000}}
    prod: {^RandomInt: {min: 0, max: 10000}}
    prid: {^RandomDouble: {min: 0.0, max: 1000.0}}
    data: {^Join: {array: ["aaaaaaaaaa", {^FastRandomString: {length: {^RandomInt: {min: 0, max: 10}}}}]}}

  LLTIndexes: &LLTIndexes
    - keys: {cuid: 1, data: 1}
    - keys: {caid: 1, prid: 1, cuid: 1}
    - keys: {prid: 1, ts: 1, cuid: 1}

  InsertWriteCommand:  &InsertCommand
    WriteCommand: insertOne
    Document: *Doc

LoaderPhase:
  BatchSize: 100
  CollectionCount: *InsertCollectionCount
  Database: *dbname
  Document: *Doc
  DocumentCount: { ^Parameter: { Name: "DocumentCount", Default: *InitialNumDocs } }
  Indexes: { ^Parameter: { Name: "Indexes", Default: *LLTIndexes } }
  Repeat: 1
  Threads: *InsertCollectionCount

InsertPhase:
  Duration: 1 minutes
  RecordFailure: true
  Collection: {^Parameter: {Name: "Collection", Default: "Collection0"}}
  Operations:
    - OperationName: bulkWrite
      OperationCommand:
        WriteOperations:
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
          - *InsertCommand
        Options:
          WriteConcern:
            Level: majority
